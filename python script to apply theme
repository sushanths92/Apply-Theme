import os
import shutil
import json

# Determine the path to the Themer folder
current_dir = os.path.dirname(os.path.abspath(__file__))
themer_folder = current_dir

# Define paths within the Themer folder
standard_resources_folder = os.path.join(themer_folder, 'standard_settings', 'KLA Power BI Template Visuals.Report', 'StaticResources', 'RegisteredResources')
pbi_file_folder = os.path.join(themer_folder, 'pbi_file_in_pbip_format')

# Find the dynamic folder name within the pbi_file_in_pbip_format folder
dynamic_pbi_folder = None
for item in os.listdir(pbi_file_folder):
    item_path = os.path.join(pbi_file_folder, item)
    if os.path.isdir(item_path) and item.endswith('.Report'):
        dynamic_pbi_folder = item_path
        break

if dynamic_pbi_folder is None:
    raise FileNotFoundError("No folder ending with '.Report' found in the pbi_file_in_pbip_format directory.")

pbi_resources_folder = os.path.join(dynamic_pbi_folder, 'StaticResources', 'RegisteredResources')
report_json_path = os.path.join(dynamic_pbi_folder, 'definition', 'report.json')
page_json_folder = os.path.join(dynamic_pbi_folder, 'pages')

# Function to copy registered resources
def copy_registered_resources():
    if not os.path.exists(pbi_resources_folder):
        os.makedirs(pbi_resources_folder)
    
    for item in os.listdir(standard_resources_folder):
        s = os.path.join(standard_resources_folder, item)
        d = os.path.join(pbi_resources_folder, item)
        if os.path.isfile(s):
            shutil.copy2(s, d)
        elif os.path.isdir(s):
            shutil.copytree(s, d, dirs_exist_ok=True)

# Function to replace the objects section in page.json files
def replace_objects_section():
    # Find a sample page.json in the standard_settings folder
    standard_page_json_folder = os.path.join(themer_folder, 'standard_settings', 'KLA Power BI Template Visuals.Report', 'definition', 'pages')
    sample_page_json_path = None
    for item in os.listdir(standard_page_json_folder):
        if item.endswith('.json'):
            sample_page_json_path = os.path.join(standard_page_json_folder, item)
            break

    if sample_page_json_path is None:
        raise FileNotFoundError("No page.json file found in the standard_settings folder.")

    # Load the ob
